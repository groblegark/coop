# SPDX-License-Identifier: BUSL-1.1
# Copyright (c) 2026 Alfred Jean LLC

apiVersion: v1
kind: Pod
metadata:
  name: coop-standalone
spec:
  containers:
    - name: coop
      image: coop:latest
      args:
        - "--agent=claude"
        - "--port=8080"
        - "--health-port=9090"
        - "--cols=200"
        - "--rows=50"
        - "--auth-token=$(COOP_AUTH_TOKEN)"
        - "--"
        - "claude"
        - "--dangerously-skip-permissions"
      env:
        - name: COOP_AUTH_TOKEN
          valueFrom:
            secretKeyRef: { name: coop-auth, key: token }
        - name: ANTHROPIC_AUTH_TOKEN
          valueFrom:
            secretKeyRef: { name: anthropic-credentials, key: auth-token }
      ports:
        - { containerPort: 8080, name: api }
        - { containerPort: 9090, name: health }
      livenessProbe:
        httpGet: { path: /api/v1/health, port: health }
        initialDelaySeconds: 5
        periodSeconds: 10
      readinessProbe:
        httpGet: { path: /api/v1/agent/state, port: health }
        initialDelaySeconds: 3
        periodSeconds: 5
      startupProbe:
        httpGet: { path: /api/v1/health, port: health }
        failureThreshold: 30
        periodSeconds: 2
      resources:
        requests: { cpu: "500m", memory: "1Gi" }
        limits:   { cpu: "2",    memory: "4Gi" }
  restartPolicy: Never
